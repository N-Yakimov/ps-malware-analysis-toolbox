# Set the time range
$startTime = (Get-Date).AddDays(-7)
$endTime = Get-Date

# Create a filter XML to retrieve events within the time range
$filterXml = @"
<QueryList>
  <Query Id="0" Path="Security">
    <Select Path="Security">*[System[TimeCreated[@SystemTime&gt;='$($startTime.ToString('yyyy-MM-ddTHH:mm:ssZ'))']]]</Select>
  </Query>
  <Query Id="1" Path="Application">
    <Select Path="Application">*[System[TimeCreated[@SystemTime&gt;='$($startTime.ToString('yyyy-MM-ddTHH:mm:ssZ'))']]]</Select>
  </Query>
  <Query Id="2" Path="System">
    <Select Path="System">*[System[TimeCreated[@SystemTime&gt;='$($startTime.ToString('yyyy-MM-ddTHH:mm:ssZ'))']]]</Select>
  </Query>
</QueryList>
"@

# Check if the export folder exists, and create it if it doesn't
$outputFolder = "Scripts/Exports"
if (!(Test-Path $outputFolder -PathType Container)) {
    New-Item -ItemType Directory -Path $outputFolder | Out-Null
}

# Export the events to a CSV file within the "Exports" folder
$exportPath = Join-Path -Path $outputFolder -ChildPath "event_logs_$(Get-Date -Format 'yyyyMMdd_HHmmss').csv"

Write-Host "Starting to export Event logs for the past 7 days to: $exportPath"

# Query the Event Viewer
$events = Get-WinEvent -FilterXml $filterXml

# Export the events to a CSV file within the "Exports" folder
$events | Export-Csv -Path $exportPath -NoTypeInformation

Write-Host "Event logs for the paste 24 hours have been exported to: $exportPath"