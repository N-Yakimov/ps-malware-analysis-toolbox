# Define the export folder and CSV file path
$exportFolder = "Scripts/Exports"
$csvPath = Join-Path -Path $exportFolder -ChildPath "services.csv"

# Check if the export folder exists, and create it if it doesn't
if (!(Test-Path -Path $exportFolder -PathType Container)) {
    New-Item -ItemType Directory -Force -Path $exportFolder | Out-Null
}

Write-Host "Exporting all running Services"

# Get all running services
$services = Get-Service | Where-Object { $_.Status -eq "Running" }

# Create an array to store service details
$serviceDetailsArray = @()

# Populate service details array
foreach ($service in $services) {
    $serviceDetails = Get-WmiObject -Class Win32_Service | Where-Object { $_.Name -eq $service.Name }

    # Create a custom object with service details
    $serviceObject = [PSCustomObject] @{
        "Service Name" = $service.Name
        "Display Name" = $service.DisplayName
        "Status" = $service.Status
        "Start Type" = $service.StartType
        "Description" = $service.Description
        "Path" = $service.Path
        "Start Name" = $service.StartName
        "Start Mode" = $service.StartMode
        "Process ID" = $serviceDetails.ProcessId
        "Service Type" = $serviceDetails.ServiceType
        "System Name" = $serviceDetails.SystemName
        "Caption" = $serviceDetails.Caption
    }

    # Add the service object to the array
    $serviceDetailsArray += $serviceObject
}

# Export service details to a CSV file
$serviceDetailsArray | Export-Csv -Path $csvPath -NoTypeInformation

Write-Host "Service details exported to $csvPath"